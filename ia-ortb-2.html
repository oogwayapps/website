<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- https://run.mocky.io/v3/53570b47-35fa-4fed-8faf-da7710dd0456 -->
    <div id="gg-ad-renderer"></div>
    <script>
      if (window.vuplex) {
        addMessageListener();
      } else {
        window.addEventListener("vuplexready", addMessageListener);
      }
      function addMessageListener() {
        console.log("Vuplex is ready. Adding message listener.");
        window.vuplex.addEventListener("message", function (event) {
          console.log("Message received from Unity:", event.data);
          document.getElementById("response").innerText = event.data;
        });
      }
      function getWidthFromUnity() {
        console.log("Sending message to Unity: GetWidth");
        window.vuplex.postMessage("GetWidth");
      }
      function getHeightFromUnity() {
        console.log("Sending message to Unity: GetHeight");
        window.vuplex.postMessage("GetHeight");
      }
      if (window.vuplex) {
        getHeightFromUnity();
        getWidthFromUnity();
      }

      async function renderAddToIframe() {
        const adRenderer = document.getElementById("gg-ad-renderer");
        const iframe = document.createElement("iframe");
        iframe.width = "300";
        iframe.height = "250";
        iframe.scrolling = "no";
        iframe.frameBorder = "0";
        const res = await fetch(
          "https://run.mocky.io/v3/53570b47-35fa-4fed-8faf-da7710dd0456"
        );
        const data = await res.json();
        const html = data.seatbid[0].bid[0].adm;
        iframe.srcdoc = html;
        adRenderer.appendChild(iframe);
      }
      renderAddToIframe();
    </script>
  </body>
</html>
